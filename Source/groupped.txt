function groupSitesByDuration(sites) {
    var grouppedSites = [];
    var durationSum = 0;

    function getIndexById(id) {
        for (var i = 0; i < length; i++) {
            if (grouppedSites[i].id == id)
                return i;
        }

        return -1;
    }

    $.each(sites, function (index, val) {
        var totalDuration = val.duration || 0;
        var site = {};

        val = val[1];

        var index = getIndexById(val.url.host + "_" + val.status);

        if (index != -1) {
            totalDuration += grouppedSites[index].duration;
            durationSum += totalDuration;

            grouppedSites[index].duration += totalDuration;

            if (!grouppedSites[index].completed) {
                if (val.favIconUrl) {
                    grouppedSites[index].favIconUrl = val.favIconUrl;
                    grouppedSites[index].title = val.title;
                    grouppedSites[index].host = val.url.host;
                    grouppedSites[index].completed = true;
                }
            }

            if (grouppedSites[index].from > val.from) {
                grouppedSites[index].from = val.from;
            }

            if (grouppedSites[index].to < val.to) {
                grouppedSites[index].to = val.to;
            }
        }
        else {
            site.id = val.url.host + "_" + val.status;
            site.host = val.url.host;

            if (isNaN(val.duration)) {
                site.duration = 0;
            }
            else {
                site.duration = val.duration;
                durationSum += val.duration;
            }

            site.status = val.status;
            site.title = val.title;
            site.favIconUrl = val.favIconUrl;
            site.from = val.from;
            site.to = val.to;

            grouppedSites.push(site);
        }
    });

    grouppedSites.duration = durationSum;

    return grouppedSites;
}